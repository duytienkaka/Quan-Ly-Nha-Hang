@model IEnumerable<RestaurantMVC.Models.MonAn>
@{
    var tableId = ViewBag.TableId;
}
<h5>üçΩ Ch·ªçn m√≥n cho b√†n @tableId</h5>

<table class="table table-bordered">
    <thead class="table-light">
        <tr>
            <th>T√™n m√≥n</th>
            <th>Gi√°</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var mon in Model)
        {
            <tr>
                <td>@mon.TenMon</td>
                <td>@String.Format("{0:N0}", mon.Gia)</td>
                <td><input type="number" id="qty-@mon.MaMon" value="1" min="1" class="form-control form-control-sm"
                        style="width:70px;"></td>
                <td><button class="btn btn-success btn-sm" onclick="addItem(@tableId,@mon.MaMon)">Th√™m</button></td>
            </tr>
        }
    </tbody>
</table>

<div id="current-order"></div>

<script>
    function addItem(tableId, foodId) {
        const qty = $(`#qty-${foodId}`).val();
        fetch("/Staff/AddItem", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `tableId=${tableId}&foodId=${foodId}&quantity=${qty}`
        })
            .then(res => {
                if (res.ok) {
                    $("#current-order").load(`/Staff/CurrentOrder?tableId=${tableId}`);
                } else {
                    console.error("L·ªói khi th√™m m√≥n:", res.status);
                }
            });
    }

    $(function () {
        $("#current-order").load(`/Staff/CurrentOrder?tableId=${@tableId}`);
    });
</script>