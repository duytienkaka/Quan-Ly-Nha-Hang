@model IEnumerable<RestaurantMVC.Models.Ban>

<form id="formBooking" class="border rounded p-3 bg-white">
  <div class="mb-2">
    <label>H·ªç t√™n:</label>
    <input type="text" class="form-control" id="hoTen" required>
  </div>
  <div class="mb-2">
    <label>S·ªë ƒëi·ªán tho·∫°i:</label>
    <input type="text" class="form-control" id="soDienThoai" required>
  </div>
  <div class="mb-2">
    <label>S·ªë ng∆∞·ªùi:</label>
    <input type="number" class="form-control" id="soNguoi" min="1" required>
  </div>
  <div class="mb-2">
    <label>B√†n:</label>
    <select class="form-select" id="tableId" required>
      <option value="">-- Ch·ªçn b√†n tr·ªëng --</option>
      @foreach (var b in Model)
      {
          <option value="@b.MaBan">@b.TenBan (S·ª©c ch·ª©a: @b.SucChua)</option>
      }
    </select>
  </div>
  <div class="mb-2">
    <label>Ghi ch√∫:</label>
    <textarea class="form-control" id="ghiChu"></textarea>
  </div>
  <button type="button" class="btn btn-success" onclick="bookTable()">ƒê·∫∑t b√†n</button>
</form>

<script>
function bookTable(){
  const data = {
    tableId: $("#tableId").val(),
    hoTen: $("#hoTen").val(),
    soDienThoai: $("#soDienThoai").val(),
    soNguoi: $("#soNguoi").val(),
    ghiChu: $("#ghiChu").val()
  };
  fetch("/CustomerHome/Book", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: $.param(data)
  }).then(r => r.json()).then(result => {
    if(result.orderId){
      const coc = prompt("üí≥ Nh·∫≠p s·ªë ti·ªÅn c·ªçc ƒë·ªÉ x√°c nh·∫≠n ƒë·∫∑t b√†n:");
      if(coc){
        fetch("/CustomerHome/PayDeposit", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `orderId=${result.orderId}&amount=${coc}`
        }).then(() => {
          alert("‚úÖ ƒê·∫∑t b√†n v√† thanh to√°n c·ªçc th√†nh c√¥ng!");
          $("#booking-form").load("/CustomerHome/BookingForm");
          $("#booking-history").load("/CustomerHome/BookingHistory");
        });
      }
    }
  });
}

</script>
